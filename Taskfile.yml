version: '3'

tasks:
  default:
    desc: default (print all ifs)
    cmds:
      - go run main.go
  openlive:
    desc: Run pcap.OpenLive() example
    dir: cmd/openlive
    cmds:
      - go build
      - sudo ./openlive
  openoffline:
    desc: Run pcap.OpenOffline() example
    dir: cmd/openoffline
    cmds:
      - go build
      - cmd: sudo timeout 3s tcpdump -i eth0 -w example.pcap 'tcp'
        ignore_error: true
      - sudo ./openoffline
  bpffilter:
    desc: Run pcap.OpenOffline() with BPF Filter
    dir: cmd/bpffilter
    cmds:
      - go build
      - cmd: sudo bash ./tcpdump.sh
        ignore_error: true
      - cmd: bash ./ping.sh
        ignore_error: true
      - cmd: sudo bash ./kill.sh
        ignore_error: true
      # tcpdumpがpcapファイルを出力する猶予を与える
      - sleep 1
      - sudo ./bpffilter
  fmtvet:
    desc: go fmt and go vet
    cmds:
      - go fmt ./...
      - go vet ./...
      - staticcheck ./...
      - revive ./...
